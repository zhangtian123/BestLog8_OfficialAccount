<!--
	作者：lcf
	时间：2017-07-06
	描述：状态反馈-拖车-接单
-->
<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="/stylesheets/mui.min.css" rel="stylesheet" />
		<link href="/stylesheets/formsheet.css" rel="stylesheet" />
		<link href="/stylesheets/feedback.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="/stylesheets/mui.picker.min.css" />
		<style type="text/css">
			#btn{
				/*width:200px;
				height:50px;
				background:deeppink;
				text-align:center;
				line-height:50px;
				margin:10px auto;*/
			}
			.album{
				width:100%;
				display:flex;
				height:auto;
				background:#999999;
				min-height:50px;
				justify-content:space-around;
				flex-wrap:wrap;
			}
			.album>div{
				width:24%;
				height:auto;
			}
			.album>div>img{
				width:100%;
			}
		</style>
	</head>
	<body>
		<div class="mui-content-padded contain">
			<div class="register">
				<form>
					<div class="mui-input-row status-row" style="border: none;">
						<label><img src="/images/lights.png" width="25px;"></label>
						<span>接单</span>
					</div>
					<div class="mui-input-row">
						<label><img src="/images/clock.png" width="25px;"></label>
						<input id='result' type="text" class="mui-input-clear shortline" placeholder="请选择实际接单时间" />
						<button id='demo1' type="button" data-options='{}' class="vertify btn mui-btn mui-btn-primary">选择</button>
					</div>
					<div class="mui-input-row">
						<label><img src="/images/edit.png" width="25px;"></label>
						<input id="description" type="text" class="mui-input-clear" placeholder="请编辑相关描述" />
						<span class="mui-icon mui-icon-clear mui-hidden"></span>
					</div>
					<div class="mui-input-row" style="border: none;">
						<label><img src="/images/拍照.png" width="25px;"></label>
						<input readonly="readonly" type="text" class="mui-input-clear shortline" placeholder="请拍照或者相册选择图片上传" />
					</div>
					<div class="feedback" style="text-align:left">  
			            <div id="btn" class="image-item"></div>
		                <div class="album" style="display:none"></div>
			        </div>  
					<!--<div class="mui-input-row" style="border: none;height: 12.5rem;">
						<label><img src="/images/拍照.png" width="25px;"></label>
						<div class="photo"></div>
						<button type="button" class="mui-btn">点击拍照</button>
					</div>-->
					<button type="button" id="submit" class="mui-btn mui-btn-block submit" style="margin-top: 20%;">提交</button>
				</form>
				
			</div>
		</div>
		<script src="/javascripts/jquery-1.11.1.min.js"></script>
		<script src="/javascripts/mui.min.js"></script>
		<script src="/javascripts/mui.picker.min.js"></script>
		<!--<script src="/javascripts/feedbackone.js"></script>
		<script src="/javascripts/feedbackmore.js"></script>-->
		<script src="/javascripts/cslCamera.js"></script>
		<script type="text/javascript">
			(function($) {
				$.init();
				var result = $('#result')[0];
				var btns = $('.btn');
				btns.each(function(i, btn) {
					btn.addEventListener('tap', function() {
						var optionsJson = this.getAttribute('data-options') || '{}';
						var options = JSON.parse(optionsJson);
						var id = this.getAttribute('id');
						/*
						 * 首次显示时实例化组件
						 * 示例为了简洁，将 options 放在了按钮的 dom 上
						 * 也可以直接通过代码声明 optinos 用于实例化 DtPicker
						 */
						var picker = new $.DtPicker(options);
						picker.show(function(rs) {
							/*
							 * rs.value 拼合后的 value
							 * rs.text 拼合后的 text
							 * rs.y 年，可以通过 rs.y.vaue 和 rs.y.text 获取值和文本
							 * rs.m 月，用法同年
							 * rs.d 日，用法同年
							 * rs.h 时，用法同年
							 * rs.i 分（minutes 的第二个字母），用法同年
							 */
							document.getElementById("result").value=rs.text;
							/*result.innerText = '选择结果: ' + rs.text;*/
							/* 
							 * 返回 false 可以阻止选择框的关闭
							 * return false;
							 */
							/*
							 * 释放组件资源，释放后将将不能再操作组件
							 * 通常情况下，不需要示放组件，new DtPicker(options) 后，可以一直使用。
							 * 当前示例，因为内容较多，如不进行资原释放，在某些设备上会较慢。
							 * 所以每次用完便立即调用 dispose 进行释放，下次用时再创建新实例。
							 */
							picker.dispose();
						});
					}, false);
				});
			})(mui);
			
			var id='';
			var billcode='';
			var billNo='';
			$(document).ready(function(){
				var urlperson=decodeURI(location.search);
			    var theRequest = new Object();
			    if (urlperson.indexOf("?") != -1) {
			        var str = urlperson.substr(1);  
			        strs = str.split("&");   
			        for(var i = 0; i < strs.length; i ++) {   
			        theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]);   
			        }
			        id = theRequest['orderid'];
			        billcode = theRequest['billcode'];
			        billNo = theRequest['billNo'];
			        //$('.leftnav li:nth-child('+nowpageid+')').siblings().removeClass("act");
			        //$('.leftnav li:nth-child('+nowpageid+')').addClass("act");
			    }
			})
			var oMyForm = new FormData();
			//oMyForm.enctype="multipart/form-data";
			var selectCount=0;
			$('#submit').click(function(){
				var result = $('#result').val(); 
				var description = $('#description').val();
				oMyForm.append("BILLID",id);
				oMyForm.append("BILLCODE",billcode);
				oMyForm.append("BILLNO",billNo);
				oMyForm.append("FINISHEDDATE",result);
				oMyForm.append("REMARK",description);
				oMyForm.append("state","FMS_TCMX05");
				$.ajax({
					type:"post",
					url:"/statusTrailer",
					data:oMyForm,
					async:false,
					cache:false,
					contentType:false,
                    processData:false,
					success:function(data){
						var result = eval(data);
						if(result.result == 0)
						{
							mui.toast("状态反馈成功");
							setTimeout(mui.openWindow('/stateback2'),1500);
						}
						else
						{
							mui.toast("状态反馈失败");
						}
						//alert(result.result);
					},
					error:function(){
						mui.alert("系统处理错误");
					}
				});
			})
		</script>
		<script type="text/javascript">
		var img=$(".img");
		var callBack=function(album){
			//alert(album);
			console.log(album);
			console.log(img);
			album.forEach(function(val,idx){
				var div=$("<div></div>");
				var img=$("<img/>");
				img.attr("src",val.data);
				div.append(img);
				$(".album").append(div);
				$(".album").show();
			});
		}
		var carera=new $.Pgater($("#btn"),callBack);
	    </script>
	</body>

</html>